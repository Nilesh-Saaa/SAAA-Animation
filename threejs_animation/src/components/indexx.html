<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Particle Logo Animation</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                background: #000;
                overflow-x: hidden;
                font-family: 'Arial', sans-serif;
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
            }

            canvas {
                /* border: 1px solid #333;  */
                /* Added for visibility */
            }

            .particle {
                position: absolute;
                width: 12px;
                height: 12px;
                overflow: hidden;
                border-radius: 50%;
            }

            .particle img {
                position: absolute;
                height: 100%;
                width: 100%;
            }
        </style>
    </head>
    <body>
        <div>
            <canvas></canvas>
        </div>

        <script>
            const canvas = document.querySelector('canvas');
            const ctx = canvas.getContext('2d');
            const particles = [];

            let mouseX = Infinity;
            let mouseY = Infinity;

            canvas.addEventListener('mousemove', e => {
                const rect = canvas.getBoundingClientRect();
                mouseX = e.clientX - rect.left;
                mouseY = e.clientY - rect.top;
            });

            canvas.addEventListener('mouseleave', () => {
                mouseX = Infinity;
                mouseY = Infinity;
            });

            const img = new Image();
            img.src = '/images/Screenshot 2025-10-25 101941-Photoroom.png';

            const PARTICLE_DIAMETER = 3;

            img.addEventListener('load', () => {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                const imgData = ctx.getImageData(0, 0, img.width, img.height).data;

                const numRows = Math.round(img.height / PARTICLE_DIAMETER);
                const numCols = Math.round(img.width / PARTICLE_DIAMETER);

                for (let row = 0; row < numRows; row++) {
                    for (let column = 0; column < numCols; column++) {
                        const pixelIndex =
                            (row * PARTICLE_DIAMETER * img.width + column * PARTICLE_DIAMETER) * 4;
                        const red = imgData[pixelIndex];
                        const green = imgData[pixelIndex + 1];
                        const blue = imgData[pixelIndex + 2];
                        const alpha = imgData[pixelIndex + 3];

                        // Only create particles for non-transparent pixels
                        if (alpha > 50) {
                            particles.push({
                                x: column * PARTICLE_DIAMETER + PARTICLE_DIAMETER / 2,
                                y: row * PARTICLE_DIAMETER + PARTICLE_DIAMETER / 2,
                                originX: column * PARTICLE_DIAMETER + PARTICLE_DIAMETER / 2,
                                originY: row * PARTICLE_DIAMETER + PARTICLE_DIAMETER / 2,
                                color: `rgba(${red},${green},${blue},${alpha / 255})`,
                            });
                        }
                    }
                }

                drawParticles();
            });

            // Add error handling for image loading
            img.addEventListener('error', () => {
                console.error('Failed to load image: PurpleBlackLogo.svg');
                console.log(
                    'Please make sure the image file exists in the same directory as your HTML file'
                );
            });

            function drawParticles() {
                updateParticles();
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(particle => {
                    ctx.fillStyle = particle.color;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, PARTICLE_DIAMETER / 2, 0, Math.PI * 2);
                    ctx.fill();
                });

                requestAnimationFrame(drawParticles);
            }

            function updateParticles() {
                const REPEL_RADIUS = 50;
                const REPEL_SPEED = 5;

                particles.forEach(particle => {
                    const distanceFromMouseX = mouseX - particle.x;
                    const distanceFromMouseY = mouseY - particle.y;
                    const distanceFromMouse = Math.sqrt(
                        distanceFromMouseX ** 2 + distanceFromMouseY ** 2
                    );

                    if (
                        distanceFromMouse < REPEL_RADIUS &&
                        mouseX !== Infinity &&
                        mouseY !== Infinity
                    ) {
                        const angle = Math.atan2(distanceFromMouseY, distanceFromMouseX);
                        const repelForce = (REPEL_RADIUS - distanceFromMouse) / REPEL_RADIUS;
                        const moveX = Math.cos(angle) * repelForce * REPEL_SPEED;
                        const moveY = Math.sin(angle) * repelForce * REPEL_SPEED;

                        particle.x -= moveX;
                        particle.y -= moveY;
                    } else if (particle.x !== particle.originX || particle.y !== particle.originY) {
                        const distanceFromOriginX = particle.originX - particle.x;
                        const distanceFromOriginY = particle.originY - particle.y;
                        const distanceFromOrigin = Math.sqrt(
                            distanceFromOriginX ** 2 + distanceFromOriginY ** 2
                        );

                        if (distanceFromOrigin > 0.5) {
                            const angle = Math.atan2(distanceFromOriginY, distanceFromOriginX);
                            const moveX = Math.cos(angle) * distanceFromOrigin * 0.1;
                            const moveY = Math.sin(angle) * distanceFromOrigin * 0.1;
                            particle.x += moveX;
                            particle.y += moveY;
                        } else {
                            // Snap to original position when very close
                            particle.x = particle.originX;
                            particle.y = particle.originY;
                        }
                    }
                });
            }
        </script>
    </body>
</html>
